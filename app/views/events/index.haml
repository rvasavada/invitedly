%h1.form-h1
  = link_to 'Create event', new_occasion_event_path(@occasion), :class => "btn btn-primary pull-right"
  Events
  %small
    %strong#row_count=@events.count
    events found
.panel-group#accordion
  - @events.each do |event|
    .panel.panel-default{id: "row#{event.id}"}
      .panel-body 
        %h2.form-h2
          .btn-group
            = link_to event.name, occasion_event_path(@occasion,event), :class => "btn btn-lg btn-default"
            %button.btn.btn-lg.btn-default.dropdown-toggle{"data-toggle" => "dropdown", type: "button"}      
              %span.caret
            %ul.dropdown-menu
              %li= link_to "Manage guest list", occasion_event_path(@occasion,event)
              %li= link_to "Invite guests", occasion_event_invite_guests_path(@occasion,event), data: {remote: true}
              %li= link_to "Edit event", edit_occasion_event_path(@occasion, event)
              %li.divider
              %li= link_to "Delete event", occasion_event_path(@occasion, event), method: :delete,  remote: true, 'data-type' => 'json', data: {confirm: 'Are you sure you want to delete this event?'}
                       
        %span.glyphicon.glyphicon-calendar
        %strong Date and Time
        %br
        = event.start_date.strftime("%A	%B %e, %Y")
        at
        = event.start_time
        %br
        %br

        %span.glyphicon.glyphicon-map-marker
        %strong Location
        %br
        = link_to event.location, "https://maps.google.com/maps?q=#{event.address}",:target => "_blank"
        %br
        = "#{event.address_1} #{event.address_2 if event.address_2.present? } <br>".html_safe if event.address_1.present?
        = "#{event.city}, #{event.state} #{event.zip}".html_safe if ((event.city.present? or event.zip.present?) and (event.country == 'United States'))
        = "#{event.city}, #{event.region} #{event.postal_code} <br>".html_safe if ((!event.region.blank? or !event.postal_code.blank?) and (event.country != 'United States'))
        = "#{event.country}" if event.country != 'United States'
  
        %br
        %br
  
        %span.glyphicon.glyphicon-info-sign
        %strong Description
        %br
        = event.description
      .panel-footer
        - invited = event.invitations
        - attending = invited.where(:response => "Attending")
        - might_attend = invited.where(:response => "Might Attend")
        - not_attend = invited.where(:response => "Not Attending")
        - not_responded = invited.where(:response => "Not Responded")
        .btn-group
        
          = link_to "<strong>#{attending.count}</strong> attending".html_safe, occasion_event_path(@occasion, event, :response => "Attending"), :class => "btn btn-default btn-success"
          = link_to "<strong>#{might_attend.count}</strong> might attend".html_safe, occasion_event_path(@occasion, event, :response => "Might Attend"), :class => "btn btn-default btn-warning"
          = link_to "<strong>#{not_attend.count}</strong> not attending".html_safe, occasion_event_path(@occasion, event, :response => "Not Attending"), :class => "btn btn-default btn-danger"
          = link_to "<strong>#{not_responded.count}</strong> not responded".html_safe, occasion_event_path(@occasion, event, :response => "Not Responded"), :class => "btn btn-default"

%p.text-center#no_row_found 
  %em No events found
= render "layouts/modal"
