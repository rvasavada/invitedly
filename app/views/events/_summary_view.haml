%ul.list-group
  %li.list-group-item
    .pull-right
      %strong View:
      - if params[:v] == "d"
        = link_to "Summary", occasion_event_path(@occasion, @event)
        |
        Details
      - else
        Summary
        |
        = link_to "Details", occasion_event_path(@occasion, @event, v: "d")
    
    %ul.list-inline
      %li
        %strong Guest Status:
      %li.text-info{style: params[:status].blank? && params[:tag].blank? ? "background-color:yellow;": ""}
        %strong=@event.rsvps.where(:visibility => true).count
        =link_to "All", occasion_event_path(@occasion, @event)
      %li.text-success{style: params[:status] == "Attending" ? "background-color:yellow;" : ""}
        %strong=@event.rsvps.where(:visibility => true, :response => "Attending").count
        =link_to "Attending", occasion_event_path(@occasion, @event, :status => "Attending")
      %li{style: params[:status] == "Not Attending" ? "background-color:yellow;" : ""}
        %strong=@event.rsvps.where(:visibility => true, :response => "Not Attending").count
        =link_to "Not Attending", occasion_event_path(@occasion, @event, :status => "Not Attending")
      %li.text-warning{style: params[:status] == "Not Responded" ? "background-color:yellow;" : ""}
        %strong=@event.rsvps.where(:visibility => true, :response => "Not Responded").count
        =link_to "Not Responded", occasion_event_path(@occasion, @event, :status => "Not Responded")
  %li.list-group-item
    .row
      .col-sm-4
        .form-group
          %strong Tags:
          - Invitation.tag_counts.each do |t|
            =link_to t.name, occasion_event_path(@occasion, @event, :tag => t.name), class: "btn btn-info btn-xs"
      .col-md-4.col-sm-offset-4
        = form_tag occasion_event_path(@occasion,@event), :method => :get do
          .input-group
            = search_field_tag :q, nil, placeholder: "Search invitation name", class: "form-control"
            .input-group-btn
              %button.btn.btn-warning{type: "submit"}
                %span.glyphicon.glyphicon-search

      -#%strong Download:
      -#= link_to "CSV", occasion_invitations_path(@occasion, format: "csv")
  .table-responsive
    %table.table.table-hover.table-condensed#invitation_guest
      %thead
        %tr
          %th Invitation name
          %th Attending
          %th Not Attending
          %th Not Responded          
          %th Invitation Status
          %th
      %tbody
        - @event.invitations.uniq.each do |invitation|
          %tr
            %td
              = invitation.name
              
              - invitation.tags.each do |t| 
                %span.label.label-primary=t

              - attending = invitation.rsvps.attending(@event)
              - not_attending = invitation.rsvps.not_attending(@event)
              - not_responded = invitation.rsvps.not_responded(@event)
          
              %td.text-success
                - if attending.count > 0
                  = link_to attending.count, "#", data: {html: true, title: "Attending (#{attending.count})", content: "#{render 'response_info', :invitation => invitation, :response => attending, :type => "attending", :event => @event.name}", trigger: "click", container: 'body', placement: "top", toggle: 'popover'}, rel: "popover", style: "color: #18bc9c;font-size:16px;"
              %td.text-danger
                - if not_attending.count > 0
                  = link_to not_attending.count, "#", data: {html: true, title: "Not Attending (#{not_attending.count})", content: "#{render 'response_info', :invitation => invitation, :response => not_attending, :type => "not_attending", :event => @event.name}", trigger: "click", placement: "top", container: 'body', toggle: 'popover'}, rel: "popover", style: "color: #E74C3B;font-size:16px;"
              %td
                - if not_responded.count > 0
                  = link_to not_responded.count, "#", data: {html: true, title: "Not Responded (#{not_responded.count})", content: "#{render 'response_info', :invitation => invitation, :response => not_responded, :type => "not_responded", :event => @event.name}", trigger: "click", placement: "top", container: 'body', toggle: 'popover'}, rel: "popover", style: "color: #2c3e50;font-size:16px;"
              %td
                = invitation.status
                %small.text-muted=" #{time_ago_in_words(invitation.updated_at)} ago"
              %td