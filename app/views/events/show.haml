.container
  %h2
    %strong=link_to "Events", occasion_events_path(@occasion)
    %small.glyphicon.glyphicon-chevron-right
    = @event.name
    %small.text-muted="(#{pluralize(@invitations.count, 'invitations')} found)"
    
  .panel.panel-default
    - if @event.rsvps.where(:visibility => true).present?
      %ul.list-group
        %li.list-group-item    
          %ul.list-inline
            %li
              %strong Guest Status:
            %li.text-info{style: params[:status].blank? && params[:tag].blank? ? "background-color:yellow;": ""}
              %strong=@event.rsvps.where(:visibility => true).count
              =link_to "All", occasion_event_path(@occasion, @event)
            %li.text-success{style: params[:status] == "Attending" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Attending").count
              =link_to "Attending", occasion_event_path(@occasion, @event, :status => "Attending")
            %li{style: params[:status] == "Not Attending" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Not Attending").count
              =link_to "Not Attending", occasion_event_path(@occasion, @event, :status => "Not Attending")
            %li.text-warning{style: params[:status] == "Not Responded" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Not Responded").count
              =link_to "Not Responded", occasion_event_path(@occasion, @event, :status => "Not Responded")
        %li.list-group-item
          .row
            .col-sm-4
              .form-group
                %strong Tags:
                - Invitation.tag_counts.each do |t|
                  =link_to t.name, occasion_event_path(@occasion, @event, :tag => t.name), class: "btn btn-info btn-xs"
            .col-md-4.col-sm-offset-4
              = form_tag occasion_event_path(@occasion,@event), :method => :get do
                .input-group
                  = search_field_tag :q, nil, placeholder: "Search invitation name", class: "form-control"
                  .input-group-btn
                    %button.btn.btn-warning{type: "submit"}
                      %span.glyphicon.glyphicon-search

            -#%strong Download:
            -#= link_to "CSV", occasion_invitations_path(@occasion, format: "csv")
        - unless @invitations.present?
          %ul.list-group
            %li.list-group-item.text-center
              %h3
                %strong Sorry, no guests found!
    
        - else
          .table-responsive
            %table.table#invitation_guest
              %thead
                %tr
                  %th{colspan: 2, width:"25%"} Invitation name
                  %th{width:"20%"} Attending       
                  %th{width:"20%"} Not Attending
                  %th{width:"20%"} Not Responded
                  %th{width:"15%"} Invitation Status          
              %tbody
                - @invitations.each do |invitation|
                  %tr.record_row{id: invitation.id}
                    %td
                      %span.glyphicon.glyphicon-chevron-right.small{id: "no_detail#{invitation.id}"}
                      %span.glyphicon.glyphicon-chevron-down.small{style:"display:none", id: "yes_detail#{invitation.id}"}
                    %td{style:"height:50px;"}
                      = check_box_tag 'invitation'
                      = link_to invitation.name, "#", style:"color:black;", class: "invitation_name", id: invitation.id
      

                      - invitation.tags.each do |t| 
                        %span.label.label-info{style:"font-weight:normal;"}=t.name

                      - attending = invitation.rsvps.attending(@event)
                      - not_attending = invitation.rsvps.not_attending(@event)
                      - not_responded = invitation.rsvps.not_responded(@event)
          
                      %td.text-success
                        - if attending.count > 0
                          - attending.each do |guests|
                            = guests.guest.full_name
                            %br
                      %td.text-danger
                        - if not_attending.count > 0
                          - not_attending.each do |guests|
                            = guests.guest.full_name
                            %br
                      %td
                        - if not_responded.count > 0
                          - not_responded.each do |guests|
                            = guests.guest.full_name
                            %br
                      %td
                        = invitation.status
                        %br
                        %small.text-muted=" #{time_ago_in_words(invitation.updated_at)} ago"
                      -#%td
                        .btn-group.btn-group-md{id: "invitation_tasks#{invitation.id}", style: "display:none;font-size:40px;"}
                          = link_to occasion_invitation_manage_path(@occasion,invitation, :guest_info), data: {title: "Edit", placement: "bottom", trigger: "hover"}, rel: "tooltip", class: "btn btn-link", style:"color:black;padding:0px 10px;" do
                            %span.glyphicon.glyphicon-pencil
                          = link_to "#", data: {title: "Send", placement: "bottom", trigger: "hover"}, rel: "tooltip", confirm: 'Are you sure you want to send this invitation?', class: "btn btn-link", style:"padding:0px 10px;", disabled: !invitation.has_email do
                            %span.glyphicon.glyphicon-envelope
                          = link_to occasion_invitation_path(@occasion,invitation), method: :delete, data: {title: "Delete", placement: "bottom", trigger: "hover"},rel: "tooltip", confirm: 'Are you sure you want to delete this invitation?', class: "btn btn-link", style:"color:red;padding:0px 10px;" do
                            %span.glyphicon.glyphicon-trash
                    %tr.edit_row.tablesorter-childRow{style: "display:none;", id: "edit_row#{invitation.id}"}
                      %td{colspan:7, style: "border-top:0px;"}
                        .row
                          .col-md-4
                            .well.well-sm{style:"background-color:#fff;"}
                              %p.text-muted.small  Guests
                              - invitation.guests.each do |guest|
                                = "#{guest.full_name}"
                                %br
                          .col-md-4
                            .well.well-sm{style:"background-color:#fff;"}
                              %p.text-muted.small  Contact Info
                              - if invitation.address_line_1.present?
                                = invitation.address_line_1
                                %br
                              - if invitation.address_line_2.present?
                                = invitation.address_line_2
                                %br
                              - if invitation.address_line_3.present?
                                = invitation.address_line_3
                                %br
                              - if invitation.cell_phone.present?
                                %abbr{title: "Mobile"} M
                                = invitation.cell_phone
                                %br
                              - if invitation.home_phone.present?  
                                %abbr{title: "Home"} H
                                = invitation.home_phone
                                %br
                              - if invitation.has_email?
                                = link_to invitation.email, "mailto:#{invitation.email}", target: :blank
                          .col-md-4
                            .well.well-sm{style:"background-color:#fff;"}
                              %p.text-muted.small Private Notes
                              =invitation.notes
    - else
      %ul.list-group
        %li.list-group-item.text-center
          %h3
            %strong You haven't invited any guests yet!