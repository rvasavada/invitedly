.container
  %h2
    %strong=link_to "Events", occasion_events_path(@occasion)
    %small.glyphicon.glyphicon-chevron-right
    = @event.name
    %small.text-muted="(#{pluralize(@invitations.count, 'invitations')} found)"
    
  .panel.panel-default
    - if @event.rsvps.where(:visibility => true).present?
      %ul.list-group
        %li.list-group-item    
          %ul.list-inline
            %li
              %strong Guest Status:
            %li.text-info{style: params[:response].blank? && params[:tag].blank? ? "background-color:yellow;": ""}
              %strong=@event.rsvps.where(:visibility => true).count
              =link_to "All", occasion_event_path(@occasion, @event)
            %li.text-success{style: params[:response] == "Attending" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Attending").count
              =link_to "Attending", occasion_event_path(@occasion, @event, :response => "Attending")
            %li{style: params[:response] == "Not Attending" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Not Attending").count
              =link_to "Not Attending", occasion_event_path(@occasion, @event, :response => "Not Attending")
            %li.text-warning{style: params[:response] == "Not Responded" ? "background-color:yellow;" : ""}
              %strong=@event.rsvps.where(:visibility => true, :response => "Not Responded").count
              =link_to "Not Responded", occasion_event_path(@occasion, @event, :response => "Not Responded")
        %li.list-group-item
          .row
            .col-sm-4
              .form-group
                %strong Tags:
                - Invitation.tag_counts.each do |t|
                  =link_to t.name, occasion_event_path(@occasion, @event, :tag => t.name), class: "btn btn-info btn-xs"
            .col-md-4.col-sm-offset-4
              = form_tag occasion_event_path(@occasion,@event), :method => :get do
                .input-group
                  = search_field_tag :q, nil, placeholder: "Search invitation name", class: "form-control"
                  .input-group-btn
                    %button.btn.btn-warning{type: "submit"}
                      %span.glyphicon.glyphicon-search

            -#%strong Download:
            -#= link_to "CSV", occasion_invitations_path(@occasion, format: "csv")
        - unless @invitations.present?
          %ul.list-group
            %li.list-group-item.text-center
              %h3
                %strong Sorry, no guests found!
    
        - else
          .table-responsive
            %table.table.table-condensed#invitation_guest
              %thead
                %tr
                  %th{width:"25%"} Invitation name
                  %th{width:"20%"} Guest name      
                  %th{width:"20%"} Response
                  %th{width:"15%"} Invitation Status          
              %tbody
                - @invitations.each do |invitation|
                  - new_invitation = true
                  - invitation.rsvps.where(:event_id => @event).each do |rsvp|
                    %tr{class: ("tablesorter-childRow" unless new_invitation)}
                      - if new_invitation
                        %td{style: "vertical-align:middle;",rowspan: (invitation.rsvps.where(event_id: @event).count if new_invitation)}
                          %label
                            = check_box_tag 'invitation'
                            %strong= invitation.name
                          - invitation.tags.each do |t| 
                            %span.label.label-info{style:"font-weight:normal;"}=t.name
                      %td{style: ("border-top:0px;" unless new_invitation)}=rsvp.guest.full_name
                      %td{style: ("border-top:0px;" unless new_invitation)}=rsvp.response
                      - if new_invitation
                        %td.text-center{style: "vertical-align:middle;", rowspan: (invitation.rsvps.where(event_id: @event).count if new_invitation)}
                          = invitation.status
                          %br
                          %small.text-muted=" #{time_ago_in_words(invitation.updated_at)} ago"
                      - new_invitation = false
                      -#%td
                        .btn-group.btn-group-md{id: "invitation_tasks#{invitation.id}", style: "display:none;font-size:40px;"}
                          = link_to occasion_invitation_manage_path(@occasion,invitation, :guest_info), data: {title: "Edit", placement: "bottom", trigger: "hover"}, rel: "tooltip", class: "btn btn-link", style:"color:black;padding:0px 10px;" do
                            %span.glyphicon.glyphicon-pencil
                          = link_to "#", data: {title: "Send", placement: "bottom", trigger: "hover"}, rel: "tooltip", confirm: 'Are you sure you want to send this invitation?', class: "btn btn-link", style:"padding:0px 10px;", disabled: !invitation.has_email do
                            %span.glyphicon.glyphicon-envelope
                          = link_to occasion_invitation_path(@occasion,invitation), method: :delete, data: {title: "Delete", placement: "bottom", trigger: "hover"},rel: "tooltip", confirm: 'Are you sure you want to delete this invitation?', class: "btn btn-link", style:"color:red;padding:0px 10px;" do
                            %span.glyphicon.glyphicon-trash
                    
    - else
      %ul.list-group
        %li.list-group-item.text-center
          %h3
            %strong You haven't invited any guests yet!