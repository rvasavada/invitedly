.btn-group.pull-right
  = link_to "Invite more guests", occasion_event_invite_guests_path(@occasion,@event), :class => "btn btn-primary", data: {remote: true}

%h1.form-h1
  =@event.name
.row
  .col-sm-3
    %ul.nav.nav-pills.nav-stacked
      %li.active=link_to "Details", "#details"
      %li=link_to "Guests", "#guests"
      
  .col-sm-9
  
    .panel-group#accordion
      .panel.panel-info#details
        .panel-body
          %h2.form-h2
            .btn-group.pull-right
              %button.btn.btn-xs.btn-default.dropdown-toggle{"data-toggle" => "dropdown", type: "button"}
                %span.caret
              %ul.dropdown-menu
                %li= link_to "Manage guest list", occasion_event_invite_guests_path(@occasion,@event), data: {remote: true}
                %li= link_to "Edit event", edit_occasion_event_path(@occasion, @event)
                %li.divider
                %li= link_to "Delete event", occasion_event_path(@occasion, @event), method: :delete,  remote: true, 'data-type' => 'json', data: {confirm: 'Are you sure you want to delete this event?'}
            Details
          %h3
            -if @attending.present?
              %strong.text-success 
                =@attending.count
                attending,
            -if @might_attend.present?
              %strong.text-warning
                =@might_attend.count
                might attend,
            -if @not_attend.present?
              %strong.text-danger
                =@not_attend.count
                not attending,
            -if @not_responded.present?
              %strong
                =@not_responded.count
                not responded
          
          %span.glyphicon.glyphicon-calendar
          %strong Date and Time
          %br
          = @event.start_date.strftime("%A, %B %e, %Y")
          at
          = @event.start_time
          %br
          %br

          %span.glyphicon.glyphicon-map-marker
          %strong Location
          %br
          = link_to @event.location, "https://maps.google.com/maps?q=#{@event.address}",:target => "_blank"
          %br
          = "#{@event.address_1} #{@event.address_2 if @event.address_2.present? } <br>".html_safe if @event.address_1.present?
          = "#{@event.city}, #{@event.state} #{@event.zip}".html_safe if ((@event.city.present? or @event.zip.present?) and (@event.country == 'United States'))
          = "#{event.city}, #{event.region} #{event.postal_code} <br>".html_safe if ((!@event.region.blank? or !@event.postal_code.blank?) and (@event.country != 'United States'))
          = "#{event.country}" if @event.country != 'United States'

          %br
          %br

          %span.glyphicon.glyphicon-info-sign
          %strong Description
          %br
          = @event.description
      .panel.panel-info#guests
        .panel-body
          %h2.form-h2
            ="Guests (#{@invites.sum(:num_guests)})"
            -if @invites.present?
              -if @attending.present?
                %h3.text-success="Attending (#{@attending.sum(:num_guests)})"
                - @attending.each do |invite|
                  - guest = Contact.find(invite.contact_id)
                  %p
                    =link_to guest.invite_name, "#"
                    %span.text-muted="+#{pluralize(invite.num_guests,'guest')}"
                    %span
                      %em=invite.message
                %hr
              -if @might_attend.present?
                %h3.text-warning="Might Attend (#{@might_attend.sum(:num_guests)})"
                - @might_attend.each do |invite|
                  - guest = Contact.find(invite.contact_id)
                  %p=guest.invite_name
              -if @not_attend.present?
                %h3.text-danger="Not Attending (#{@not_attend.sum(:num_guests)})"
                - @not_attend.each do |invite|
                  - guest = Contact.find(invite.contact_id)
                  %p=guest.invite_name              
              -if @not_responded.present?
                %h3="Not Responded (#{@not_responded.sum(:num_guests)})"
                - @not_responded.each do |invite|
                  - guest = Contact.find(invite.contact_id)
                  %p=guest.invite_name
= render "layouts/modal"