- if @invitations.present?
  .panel.panel-default
    .panel-body        
      .pull-right
        %strong View:
        - if params[:view] == "guest"
          = link_to "Invitations", occasion_invitations_path(@occasion)
        - else
          Invitation
        |
        - unless params[:view] == "guest"
          = link_to "Guests", occasion_invitations_path(@occasion, view: "guest")
        - else
          Guests
            
          
      %strong Download:
      = link_to "CSV", occasion_invitations_path(@occasion, format: "csv")
    .table-responsive
      %table.table.table-striped.table-bordered#invitation
        %thead
          %tr
            %th
            %th 
            - @occasion.events.each do |event|
              %th.text-center{colspan:3}
                =event.name
                ="(#{Rsvp.where(:visibility => true, :event_id => event).count})"
        %thead
          %tr
            %th= check_box_tag 'invitation'
            %th Invitation name
            - @occasion.events.each do |event|
              %th.text-success
                Y
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Attending").count})"
              %th.text-danger
                N
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Not Attending").count})"
              %th 
                ?
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Not Responded").count})"
        %tbody
          - @invitations.each do |invitation|
            %tr
              %td
                = check_box_tag 'invitation'
                -#= link_to occasion_invitation_manage_path(@occasion, invitation, :guest_info), data: {title: "Edit Invitation", placement: "bottom", trigger: "hover"}, rel: "tooltip", class: "btn btn-primary btn-xs" do
                  %span.glyphicon.glyphicon-pencil
                -#= link_to occasion_invitation_path(@occasion, invitation), data: {title: "Delete Invitation", placement: "bottom", trigger: "hover"}, rel: "tooltip", class: "btn btn-danger btn-xs", method: :delete do
                  %span.glyphicon.glyphicon-trash
              %td
                %strong{class: invitation.status == "Responded" ? "text-success" : ""}=invitation.household.name
                - invitation.household.tags.each do |t| 
                  %span.label.label-info=t
                %br
                %small="Last updated #{time_ago_in_words(invitation.updated_at)} ago"

              - @occasion.events.each do |event|
                - attending = 0
                - not_attending = 0
                - not_responded = 0
                - for rsvp in invitation.rsvps
                  - case
                    - when rsvp.event_id == event.id && rsvp.response == "Attending" && rsvp.visibility == true
                      - attending+=1
                    - when rsvp.event_id == event.id && rsvp.response == "Not Attending" && rsvp.visibility == true
                      - not_attending+=1
                    - when rsvp.event_id == event.id && rsvp.response == "Not Responded" && rsvp.visibility == true
                      - not_responded +=1
                %td.text-success
                  - if attending > 0
                    = attending
                %td.text-danger
                  - if not_attending > 0
                    = not_attending  
                %td
                  - if not_responded > 0
                    = not_responded
                
-else
  .well.text-center{style: "background-color:#fff;"}
    %h3 You have not invited any guests.
    = link_to "Invite guests now!", "#", "data-target" => "#myModal", "data-toggle" => "modal"