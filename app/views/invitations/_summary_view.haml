- if @invitations.present?
  .panel.panel-default
    .panel-body        
      .pull-right
        %strong View:
        - if params[:view] == "guest"
          = link_to "Invitations", occasion_invitations_path(@occasion)
        - else
          Invitation
        |
        - unless params[:view] == "guest"
          = link_to "Guests", occasion_invitations_path(@occasion, view: "guest")
        - else
          Guests
            
          
      %strong Download:
      = link_to "CSV", occasion_invitations_path(@occasion, format: "csv")
    .table-responsive
      %table.table.table-striped.table-bordered#invitation
        %thead
          %tr
            %th 
            - @occasion.events.each do |event|
              %th.text-center{colspan:3}
                =event.name
                ="(#{Rsvp.where(:visibility => true, :event_id => event).count})"
        %thead
          %tr
            %th Invitation name
            - @occasion.events.each do |event|
              %th.text-success
                Y
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Attending").count})"
              %th.text-danger
                N
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Not Attending").count})"
              %th 
                ?
                ="(#{Rsvp.where(:visibility => true, :event_id => event, :response => "Not Responded").count})"
        %tbody
          - @invitations.each do |invitation|
            %tr
              %td
                .btn-group
                  %button.btn.btn-xs.dropdown-toggle{type: "button", "data-toggle" => "dropdown", class: invitation.status == "Responded" ? "btn-success" : ""}
                    =invitation.household.name
                    %span.caret
                  %ul.dropdown-menu
                    %li= link_to "Edit Invitation", occasion_invitation_manage_path(@occasion, invitation, :guest_info)
                    %li= link_to "Delete Invitation", occasion_invitation_path(@occasion, invitation), method: :delete
                    
                -if invitation.household.tags.present?
                  %br
                  - invitation.household.tags.each do |t| 
                    %span.label.label-info=t
                %br
                %small="Last updated #{time_ago_in_words(invitation.updated_at)} ago"

              - @occasion.events.each do |event|
                - attending = []
                - not_attending = []
                - not_responded = []
                - for rsvp in invitation.rsvps.guest_view
                  - case
                    - when rsvp.event_id == event.id && rsvp.response == "Attending" && rsvp.visibility == true
                      - attending.push(rsvp.guest.full_name)
                    - when rsvp.event_id == event.id && rsvp.response == "Not Attending" && rsvp.visibility == true
                      - not_attending.push(rsvp.guest.full_name)
                    - when rsvp.event_id == event.id && rsvp.response == "Not Responded" && rsvp.visibility == true
                      - not_responded.push(rsvp.guest.full_name)
                %td.text-success
                  - if attending.length > 0
                    = link_to attending.length, "#", data: {html: true, title: "#{invitation.household.name} (#{attending.length}) - Attending", content: "#{render 'response_info', :invitation => invitation, :response => attending}", trigger: "hover", container: 'body', toggle: 'popover'}, rel: "popover"
                %td.text-danger
                  - if not_attending.length > 0
                    = link_to not_attending.length, "#", data: {html: true, title: "#{invitation.household.name} (#{not_attending.length}) - Not Attending", content: "#{render 'response_info', :invitation => invitation, :response => not_attending}", trigger: "hover", container: 'body', toggle: 'popover'}, rel: "popover"
                %td
                  - if not_responded.length > 0
                    = link_to not_responded.length, "#", data: {html: true, title: "#{invitation.household.name} (#{not_responded.length}) - Not Responded", content: "#{render 'response_info', :invitation => invitation, :response => not_responded}", trigger: "hover", container: 'body', toggle: 'popover'}, rel: "popover"
                
-else
  .well.text-center{style: "background-color:#fff;"}
    %h3 You have not invited any guests.
    = link_to "Invite guests now!", "#", "data-target" => "#myModal", "data-toggle" => "modal"